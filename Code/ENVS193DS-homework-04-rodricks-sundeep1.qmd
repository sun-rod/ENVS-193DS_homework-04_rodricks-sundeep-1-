---
title: "193DS HW #4"
author: "Sundeep Rodricks"
format: docx
editor: visual
warning: false

---

Repo link: https://github.com/sun-rod/ENVS-193DS_homework-04_rodricks-sundeep-1- 
```{r loading-packages}
library(tidyverse)
library(here)
library(naniar)
library(skimr)
library(readr)
library(performance)
library(broom)
library(flextable)
library(ggeffects)
library(car)
library(dplyr)
library(magrittr)
```

# Problem #1

## 1.

H~0~: Fish length does not predict fish weight for trout perch

H~0~: β~1~ = 0

H~a~: Fish length does predict fish weight for trout perch

H~a~: β~1~ ≠ 0

## 2.

```{r importing-data}
Fish_data <- read_csv(here("data","ntl6_v12.csv"))
    View(Fish_data)
```

```{r filtering-data}
# filtering for trout perch
    fish_filtered <- Fish_data %>% 
      filter(spname == "TROUTPERCH")

# filtering for weight and length for trout perch
trout_data <- fish_filtered[, c( "length", "weight")]
```

```{r missing-data-visualization}
gg_miss_var(trout_data) +
      labs(caption = "Figure 1: There are 199 missing weight observations for the trout perch data and 0 missing length observations")

```
```{r eval = FALSE}
   # getting a count of the missing observations from each variable
    miss_var_summary(trout_data)
```

## 3. and 4.

```{r making-a-model}
modelobject <- lm(weight ~ length, data = fish_filtered)
par(mfrow = c(2, 2))
plot(modelobject)

```

## 5.
The residuals vs. fitted plot shows that the points are mostly evenly distributed above and below the red line. The red line is also close to flat, which indicates homoskedasticity.

The scale-location plot has a red line that's close to flat and the points look to be randomly distributed. This also points toward homoskedasticity.

The normal Q-Q plot shows that points have a positive linear relationship, with most points falling in a straight line. This indicates that the data is normally distributed.

The residuals vs. leverage plot shows one point outside of the Cook's distance, which makes it an influential observation.


## 6. 

```{r summary}
model_summary <- summary(modelobject)
```

## 7.

```{r ANOVA}
model_squares <- anova(modelobject)
model_summary
```

```{r}
model_squares_table <- tidy(model_squares) %>% 
  mutate(across(sumsq:meansq, ~ round(.x, digits = 1))) %>% 
  mutate(statistic = round(statistic, digits = 1)) %>% 
  mutate(p.value = case_when(
    p.value < 0.001 ~ "< 0.001"
  )) %>% 
  mutate(term = case_when(
    term == "length" ~ "Length (mm)",
    TRUE ~ term
  )) %>% 
  flextable() %>% 
  set_header_labels(df = "Degrees of Freedom", 
                    sumsq = "Sum of squares",
                    meansq = "Mean squares",
                    statistic = "F-statistic",
                    p.value = "p-value")

model_squares_table
```


## 8.

The ANOVA table shows F-statistic as 1280.8 on 1 and 288 degrees of freedom, just like the summary() shows. The ANOVA table also tells us that the p-value is < 0.001, while the summary() shows the actual value of the p-value.

## 9.

The assumptions of the test seem to have been met based on the model plots. The summary() and ANOVA table indicate that the p-value is very small, so the null hypothesis should be rejected, which means that fish length does predict weight.

## 10.

```{r model-predictions}
predictions <- ggpredict(modelobject, terms = "length")

# predicted fish weights
predictions
```

```{r}
plot_predictions <- ggplot(data = fish_filtered, 
                           aes(x = length, y = weight)) +
  # plotting the underlying data
  geom_point() +
  # plotting the predictions
  geom_line(data = predictions, 
            aes(x = x, y = predicted), 
            color = "blue", linewidth = 1) +
  # then plot the 95% confidence interval from ggpredict
  geom_ribbon(data = predictions, 
              aes(x = x, y = predicted, ymin = conf.low, ymax = conf.high), 
              alpha = 0.2) +
  # theme and meaningful labels
  theme_bw() +
  labs(x = "Fish Length (mm)",
       y = "Fish Weight (g)", 
       caption = "Predicted Trout Perch weight based on length")


plot_predictions
```

